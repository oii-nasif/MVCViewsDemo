@model IEnumerable<Product>
@{
    ViewData["Title"] = "Products";
    var categories = ViewBag.Categories as List<string> ?? new List<string>();
    var currentCategory = ViewBag.CurrentCategory as string;
}

@section Sidebar {
    <div class="p-3">
        <h5 class="fw-bold">Categories</h5>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link @(string.IsNullOrEmpty(currentCategory) ? "active fw-bold" : "")"
                   asp-controller="Products" asp-action="Index">
                    All Products
                </a>
            </li>
            @foreach (var category in categories)
            {
                <li class="nav-item">
                    <a class="nav-link @(currentCategory == category ? "active fw-bold" : "")"
                       asp-controller="Products" asp-action="ByCategory" asp-route-category="@category">
                        @category
                    </a>
                </li>
            }
        </ul>

        <hr />

        <h5 class="fw-bold">Quick Stats</h5>
        <ul class="list-unstyled">
            <li>Total Products: <strong>@Model.Count()</strong></li>
            <li>In Stock: <strong>@Model.Count(p => p.IsAvailable)</strong></li>
            <li>Out of Stock: <strong>@Model.Count(p => !p.IsAvailable)</strong></li>
        </ul>
    </div>
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>@ViewData["Title"]</h1>
        <span class="text-muted">Showing @Model.Count() products</span>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            No products found in this category.
        </div>
    }
    else
    {
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
            @foreach (var product in Model)
            {
                <div class="col">
                    <partial name="_ProductCard" model="product" />
                </div>
            }
        </div>
    }
</div>

@section Styles {
    <style>
        .sidebar {
            position: sticky;
            top: 0;
            height: calc(100vh - 70px);
            padding-top: 1rem;
            overflow-y: auto;
        }
        .nav-link.active {
            color: #0d6efd !important;
            background-color: rgba(13, 110, 253, 0.1);
            border-radius: 0.25rem;
        }
    </style>
}
